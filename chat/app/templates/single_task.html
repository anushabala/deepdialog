<html>
    <head>
        <title>Negotiation Fun</title>
        <style>

	  div#questions {
	  float:left;
	  width: 60%;
	  }

	  div#info_container {
	  margin-left: 62%;
	  }
	  img.heart {
	  height: 15px;
	  width: 15px;
	  }

	  img.dollar {
	  height: 16px;
	  width: 9px;
	  }
	  .points {
	  color: #009933;
	  }
	  </style>
        <script type="text/javascript" src="//code.jquery.com/jquery-1.4.2.min.js"></script>
        <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js"></script>
        <script type="text/javascript" charset="utf-8">
            var socket;
            $(document).ready(function() {
                socket = io.connect('http://' + document.domain + ':' + location.port);
                socket.on('disconnect', function() {
                	socket.disconnect();
                });
            });
            function validateAndSubmit() {
	            console.log("validating response");
            	data = validateResponse();
            	console.log(data);
            	if (data['valid']) {
                    socket.emit('submit_task', data, function() {
                        window.location.reload(true);
                    });
            	}
            }

            function validateResponse() {
                ddRestaurants = document.getElementById("restaurantChoices");
            	textArea = document.getElementById("starterText");
            	selected_idx = ddRestaurants.options[ddRestaurants.selectedIndex].value;
            	selected_restaurant = ddRestaurants.options[ddRestaurants.selectedIndex].text;
            	starter_text = starterText.value;

            	if (selected_idx != -1 && starter_text != "") {
            		console.log("valid");
            	    document.getElementById('choiceError').style.display="none";
            	    document.getElementById('textError').style.display="none";
            	    return {'restaurant': selected_restaurant,
            	            'starter_text': starter_text,
            	            'valid': true};
            	}
            	if (selected_idx == -1) {
            	    document.getElementById('choiceError').style.display="block";
            	}
            	if (starter_text == "") {
                    document.getElementById('textError').style.display="block";
            	}
				console.log("error");
            	return {'valid': false};
            }
		</script>
    </head>
    <body>
    <div id="questions">
        <h3>
            There are no other users online at the moment to play with! Please answer the questions on this survey instead.
        </h3>
        <p>
            Imagine that it's a Friday night, and you're about to chat with a friend to decide where to go for dinner.
            You've discovered that there are <b>{{scenario["restaurants"]|length}}</b> restaurants nearby.
            You like some kinds of food better than others, and have a preferred price range in mind.
        </p>
        <h4>Take a look at your preferences for cuisine and price range <b>to the right</b>, and then answer the questions <b>below</b>.</h4>
        <hr>
        <p>
            Given your preferences and the different restaurant options, which restaurant would be your top choice?
        </p>

        <div id="choiceError" style="display:none"><h3>Please select a valid option below</h3></div>
        <select id="restaurantChoices">
            <option selected="selected" value=-1>-- Select one --</option>
            {% set ctr = 0 %}
            {% for restaurant in scenario["restaurants"] %}
            <option value={{ctr}}>{{ restaurant["name"] }}</option>
            {% set ctr = ctr + 1 %}
            {% endfor %}
        </select>
        <p>
            Imagine now that you're just about to start talking to your friend. 
            What would you say first to get the discussion going? (Please don't include greetings and other conversational
            dialogues like "Hi", "Where do you want to eat?", etc.)
        </p>
        <div id="textError" style="display:none"><h3>Please enter your response in the box.</h3></div>
        <textarea id="starterText" rows="2" cols="50"></textarea>
        <button id="submit_task" onclick="validateAndSubmit();">
            Submit and play again!
        </button>
    </div>

	<div id="info_container">
	<div id="preferences">

            <h3>Your cuisine preferences</h3>
            <ol class="cuisine_preferences_list">
	    {% for cuisine in agent["cuisine_func"] %}
            <li>{{cuisine["cuisine"]}} 
	      {% if config["numerical_preferences"] %} 
	      <span class="points"> ({{ cuisine["utility"] }} points) </span> 
	      {% else %} 
	      {% for i in range(cuisine["utility_rating"]) %} <img src="{{ url_for('static', filename='img/heart.svg') }}" class="heart"/> {% endfor %}
	      {% endif %} </li>
            {% endfor %}
	    </ol>

            <h3>Your price range preference</h3>

	    {% if config["numerical_prices"] %} 
	    <ul>
	      {% for obj in agent["spending_func"] %}
              <li>
		${{ obj["price_range"][0] }} - ${{ obj["price_range"][1] }}
	      </li>
	      <span class="points"> ({{ obj["utility"] }} points) </span> </li>
              {% endfor %}
	    </ul>

            {% else %}
            {% for i in range((agent["spending_func"][0]["price_rating"]) | int) %} 
              <img src="{{ url_for('static', filename='img/dollar.png') }}" class="dollar"/> 
            {% endfor %}
            {% endif %}

            <h3>Restaurants nearby</h3>
	    <ul>
            {% for restaurant in scenario["restaurants"] %}
            <li><b>{{ restaurant["name"] }}</b>: {{ restaurant["cuisine"]}}, 

	      {% if config["numerical_prices"] %} 
	      ${{ restaurant["price_range"][0] }} - ${{ restaurant["price_range"][1] }}
              {% else %}
                {% for i in range((restaurant["price_rating"]) | int) %} 
              <img src="{{ url_for('static', filename='img/dollar.png') }}" class="dollar"/> 
            {% endfor %}
            {% endif %}
	    </li>
            
	    {% endfor %}
	    </ul>
        </div>
        </div>
    </body>
</html>